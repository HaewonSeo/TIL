## 1. 학습 날짜
+ 2020-11-24(화)

## 2. 학습시간
+ 13:00 ~ 20:00 (자가)   

+ 총 학습시간 : 7시간

## 3. 학습 범위 및 주제
+ DB 뷰와 시스템 카탈로그

## 4. 동료 학습 방법

## 5. 학습 목표
+ DB 뷰와 시스템 카탈로그 학습


## 6. 상세 학습 내용
+ 실제 코딩에 소요한 시간 : 0시간    
+ DB 강의 수강 : 4시간    

### 8. 뷰와 시스템 카탈로그   
   
#### 8.1 뷰
   
뷰 : 가상 릴레이션   
   
뷰는 하나 이상의 기본릴레이션으로 부터 생성될 수 있고, 기본 릴레이션과 뷰의 조합으로 생성될 수 있다.   
   
- 릴레이션   
1. 기본 릴레이션(base relation) : 물리적으로 실제 저장되어 있는 릴레이션   
2. 가상 릴레이션(virtual relation)  : 뷰에 해당되는 것이 저장되어 있지 않다는 것을 의미. 우리는 기본 릴레이션을 통해서 뷰에 해당되는 내용을 검색하는 것다.   
   
가상 릴레이션은 dynamic window(동적인 창)의 역할을 한다. 동적인 창은 시간에 따라 변하는 릴레이션의 특정 일부분을 창을 통해서 본다는 의미이다.   
snapshot(정적인 창) :  스냅샵을 뜨는 시점의 질의에 해당되는 내용을 기본 릴레이션으로부터 구해서 저장해 놓은 것.   
기본 릴레이션은 변경된다 하더라도 스냅샷의 내용은 변경되지 않고 동일하게 유지되는 반면에, 뷰인 경우에는 기본릴레이션의 내용이 변경되면, 나중에 뷰를 통한 질의를 할 때 변경된 기본 릴레이션으로부터 질의를 수행해서 보여주게 된다.    
   
- 뷰의 장점/역할/쓰임새   
   
1. 복잡한 질의를 간단하게 표현   
   
2. 데이터 무결성 보장   
WITH CHECK OPTION 사용 시 : 뷰의 정의에 맞는 경우만 insert/update 등을 할 수 있다. 튜플이 뷰에서 사라지도록 튜플을 수정할 수도 없다.   
			SELECT문 내의 where절의 조건을 만족하지 않는 범위에서 뷰를 사용하게 되면 오류를 출력한다.   
3번 부서만을 엑세스 하는 뷰에서 사원의 부서번호를 3에서 2로 변경하게 되면, 튜플이 뷰의 정의에서 벗어나게 된다. 이런 경우에 오류를 내게 하는 것이 위 옵션이다.   
   
Q. with check option 이 없으면 무결성이 보장되지 않는건가요?   
A. 무결성이 보장되지 않는다기 보다는 무결성 체크가 하나 없어지게 되는 것이다.   
   
3. 데이터 독립성을 제공   
DB의 구조 변경으로 응용프로그램을 다시 작성해야 하는 상황이 발생. 이 때, 원래 릴레이션에 해당하는 뷰를 작성하여 제공해준다면 기존 응용프로그램에서 사용하던 select문을 계속해서 사용할 수 있다.   
물리적 독립성 : DB에서 실질적으로 저장하는 방법이 변경되어도, 그 위의 DB의 구조나 응용프로그램, 즉, 개념적 설계가 변경되지 않는 것.   
논리적 독립성 : DB의 구조가 변경되더라도 그 위의 응용프로그램이 변경되지 않는 것   
   
4. 데이터 보안 기능을 제공   
기본 릴레이션의 일부 애트리뷰트만을 사용할 수 있도록 뷰를 정의하고, 기본 릴레이션에 대한 접근의 권한을 허용하지 않고, 뷰에 대한 접근만을 허용하게 한다.   
민감한 정보는 숨기고, 나머지 정보만을 공개할 수 있다.   
   
5. 동일한 데이터에 대한 여러가지 뷰를 제공함   
하나의 기본 릴레이션에 대해서 필요에 따라 여러개의 뷰를 정의해서 제공할 수 있다.   
사용자 그룹이 각자 특정 기준에 따라 접근할 수 있는 데이터가 다를 경우, 각 사용자 그룹에 맞는 뷰를 제공하여 각각 데이터를 접근하도록 한다.   
   
- 뷰의 갱신 : 검색에는 제약사항이 없는데, 갱신에는 몇 가지 제약이 있다.   
   
1. 한 릴레이션 위에서 정의된 뷰에 대한 갱신   
주어진 insert문은 수행된다. 3개의 애트리뷰트에만 값이 주어지고, 나머지 애트리뷰트는 값이 입력되지 않는다.(NULL 값이 입력된다.). 성공적으로 삽입 연산이 수행된다.   
   
2. 두 개의 릴레이션 위에서 정의된 뷰에 대한 갱신   
대부분의 관계DBMS에 갱신이 불가능하다. 조인이 정의된 뷰라도, 뷰의 한 튜플이 기본 릴레이션의 한 튜플과 정확하게 대응되는 경우에는 갱신을 허용하는 관계 DBMS도 있다.   
하지만, 이런 DBMS에서도 기본키의 값이 널인 투플은 엔티티 무결성 제약 조건에 의해 삽입이 거절된다.   
주어진 예에서 기본키인 사원번호에 대한 입력값이 없어 기본키가 NULL값을 갖게 되고, 따라서 삽입이 거절된다.   
   
3. 집단함수 등을 포함한 뷰에 대한 갱신   
주어진 예는 개별 투플들의 값을 임의로 변경해야만 가능할 것이다. 따라서 논리적으로 타당하지 않은 연산이고 명확하지 않다. 따라서, DBMS에서 수행을 거절한다.   
   
   
- 갱신이 불가능한 뷰   
1. 한 릴레이션 위에서 정의되었으나 그 릴레이션의 기본 키가 포함되지 않은 뷰   
기본키가 포함되지 않은 뷰에 대해 INSERT 하게 되면, 기본키는 입력값이 주어지지 않아 널이 되는데, 기본키에 널이 들어가는 것은 엔티티 무결성 제약조건에 위배된다.   
2. 기본 릴레이션의 애트리뷰트들 중에서 뷰에 포함되지 않은 애트리뷰트에 대해 NOT NULL이 지정되어 있을 때   
뷰를 통해서 삽입을 할 때, 뷰에서 정의되지 않는 애트리뷰트는 입력값이 없어 null을 갖게 되는데, not null이라는 도메인 제약조건과의 충돌이 발생하게 되어 그 뷰를 통해 insert가 불가능하게 된다.   
3. 집단함수가 포함된 뷰   
4. 조인으로 정의된 뷰 :조인이 들어간 경우 갱신이 가능할수도 있고, 불가능할 수도 있다. 일반적으로 갱신을 허용하지 않는 경우가 많다.   
   
   
- 갱신 가능성 기준에 따른 뷰들의 유형   
사용자가 정의할 수 있는 모든 뷰   
이론적으로 갱신이 가능한 뷰 / 불가능한 뷰   
상용관계DBMS들이 갱신을 허용하는 뷰   
이론적으로 갱신이 가능하지만, 구현하는데 엄청나게 어려운 경우가 있다. 계산하고 체크하는 것들이 복잡하고, 시간이 오래걸리고, 구현이 어려운 경우가 있다. 이런 경우는 제외하고 체크가 쉽고 빠르게 되는 경우만을 상용 DBMS들이 갱신이 허용한다.   
갱신이 허용되는 경우에은 DBMS마다의 차이가 있다.   
   
   
#### 8.2 관계 DBMS의 시스템 카탈로그
   
시스템 카탈로그 = 메타데이터 = 데이터 사전 = 시스템 테이블   
   
- 시스템 카탈로그가 저장되는 구조    
어떤 형태로든 메타데이터를 저장하고 관리할수 있는 형태이면, 그 구조를 사용하면 된다.   
그러나 보통 관계DBMS에서 시스템 카탈로그는 일반 사용자의 릴레이션과 똑같은 형태(릴레이션 형태)로 저장된다. -> SIMPLE하지만 아주 중요한 내용이다.   
만약, 관계 DBMS에서 시스템 카탈로그를 릴레이션이 아닌 다른 형태로 저장되었다고 한다면, 카탈로그에 있는 정보를 검색하기 위해서는 릴레이션이 아니니깐 SQL문을 사용할 수 없다. 그러므로 별도의 질의나 방법을 만들어야 한다.   
그런데 그렇지 않고, 일반 릴레이션과 동일한 형태로 저장되기 때문에. 일반 릴레이션에서 사용하는 동일한 방법인 SQL을 통해 검색이 가능하다. 추가적인 질의 방법이 필요없다. 뒤에서 트랜잭션에 관한 내용을 공부하다 보면, 릴레이션에 대한 동시성 제어와 파손회복을 지원해주어야 하는데, 시스템 카탈로그도 릴레이션처럼 저장함으로써, 별도의 방법을 따로 구현할 필요없이 릴레이션을 처리하는 한가지 방법만 구현하면, 그 방법을 동일하게 적용하여 이 2 기능을 지원할 수 있다.   
   
- 시스템 카탈로그가 질의 처리에 어떻게 활용되는가?    
--> 시스템 카탈로그가 질의처리의 여러 단계에서 지속적으로 사용된다. 시스템 카탈로그는 여러 릴레이션으로 저장된다. 각각의 릴레이션은 다른 정보를 저장하고 있다.   
0. 문법적 오류를 검사   
1. SELECT 문에서 참조하는 릴레이션이 데이터베이스에 존재하는가를 검사함 -> SYS_RELATION 카탈로그가 사용된다.    
2. 릴레이션에 SELECT절에 열거된 애트리뷰트와 WHERE절에서 조건에 사용된 애트리뷰트가 존재하는가를 확인함 -> SYS_ATTRIBUTE 카탈로그가 사용된다.   
3. 애트리뷰트의 데이터 타입이 맞는지를 검사 -> SYS_ATTRIBUTE 카탈로그의 데이터 타입 정보에서 확인한다.   
4. 사용자가 애트리뷰트를 검색할 수 있는 권한이 있는가를 확인함 -> SYS_RELATION과 SYS_ATTRIBUTE에는 이 질의처리에 필요한 정보가 없다. 이런 단계를 거치려고 한다면, 이러한 정보를 모아놓은 카탈로그가 필요하다. 카탈로그에는 권한 테이블이 있다. 애트리뷰트/릴레이션별로 읽기/쓰기/수정 권한 등이 저장되어 있다.   
5. 애트리뷰트에 인덱스가 정의되어 있는지 확인함 ->  SYS_RELATION과 SYS_ATTRIBUTE에는 인덱스에 대한 정보가 없다. SYS_INDEX라는 카탈로그가 필요하다. SYS_INDEX에는 인덱스별로 정보를 가진다. 각 인덱스별로 어떤 릴레이션의 어느 애트리뷰트에 대해 인덱스를 정의하는지를 저장한다.   
   
- 관계 DBMS의 시스템 카탈로그   
1. SYS_RELATION   
여기서는 릴레이션 식별자가 RELID이지만, 일반적으로 별도의 번호를 부여하여 식별자로 사용하는 경우가 많다.   
RELWIDTH : 릴레이션 튜플을 저장하기 위한 BYTE수   
2. SYS_ATTRIBUTE    
애트리뷰트 식별자 : 애트리뷰트가 정의된 릴레이션 이름(AttrelID) + 번호(AttID)   
Attoff : 튜플을 저장하는 레코드 내에서 몇번쨰 위치에 해당 애트리뷰트가 저장되는지를 나타낸다.   
   
- 어떻게 카탈로그 테이블에 대한 정보들이 업데이트 되는가?   
일반적으로 SQL 종류 중 DDL이 있었는데, 이를 이용하여 데이터베이스 구조/객체 명령이 내려지게 되면, 연산이 수행되면서 해당되는 카탈로그 테이블이 갱신된다.   
   
인덱스를 선택하기 위해서는 , 인덱스에 대한 통계정보를 카탈로그 테이블이 가지고 있어야 한다.   
이렇듯 질의처리, DBMS 관리를 위해서 다양한 종류의 카탈로그 테이블이 사용된다.   



## 7. 학습 내용에 대한 개인적인 총평
+ 뷰의 장점과, 갱신시 유의사항을 고려하면서 db를 설계해야 함을 알았다. 
+ db를 배우면서 의문을 가지고 있었던, 시스템 카탈로그에 대한 내용을 학습하였다.
+ 교수님이 말하시는 모든 문장을 필기하려고 하다보니 강의를 듣는 시간이 배로 늘었다.
+ 그래도 대면 시 놓쳐서 필기 못하는 것보다는 비대면으로 강의를 여러번 돌려 볼 수 있다 점에서 더 나은 것 같다.
+ 어느새 학기 말인데, 더 화이팅하자.

## 8. 다음 학습 계획
+ BB알고리즘 실습